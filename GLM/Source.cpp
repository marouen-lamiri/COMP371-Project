#include <stdio.h>
#include <stdlib.h>
#include <GL/glut.h>
#include "imageloader.h"
#include "glm.h"

#define PI 3.1416

// variaveis
float x=0, y=0, z=0, rotX=0;
int fps=0, displayList=0;
bool displayFog = false;
bool displayMotionBlur = false;

GLfloat lightPos[4] = {0.0, 2.0 ,0.0, 1.0};
GLfloat lightAmb[3] = {0.1, 0.1, 0.1};
GLfloat lightDiff[3] = {1.0, 1.0, 1.0};

GLMmodel* mymodel1;
GLMmodel* mymodel2;

GLuint texture1;

void keyboard(unsigned char key, int xx, int yy) {
	glutPostRedisplay();
	switch(key) {
		case 'a' : x-=2; break; 
		case 'd' : x+=2; break; 
		case 's' : z+=2; break; 
		case 'w' : z-=2; break; 
		case '.' : y-=2; break; 
		case ',' : y+=2; break; 
		case 'k' : rotX-=2.0; break; 
		case 'i' : rotX+=2.0; break; 
		case 'm' : 
			if(displayMotionBlur){
				displayMotionBlur = false;
			}
			else {
				displayMotionBlur = true;
			}
			break; 
		case 'f' : 
			if(displayFog){
				displayFog = false;
			}
			else {
				displayFog = true;
			}
			break; 
		case 27  : exit(0);
	}
}


void changeSize(int w, int h) {
	if(h == 0) h = 1;
	float ratio = 1.0* w / h;
	
	glMatrixMode(GL_PROJECTION);
	glLoadIdentity();
    glViewport(0, 0, w, h);
	gluPerspective(25, ratio, 1, 1000);
	glMatrixMode(GL_MODELVIEW);
}

//Draw Axes
void drawAxes()
{
	glPushMatrix();
		GLboolean isEnabled = false;
		glGetBooleanv(GL_LIGHTING, &isEnabled); /* To restore this lighting later */
		glDisable(GL_LIGHTING);
		glLineWidth(2);
		glBegin(GL_LINES);
			glColor3f(1.0, 0.0, 0.0);
			glVertex3f(0.0, 0.0, 0.0);
			glVertex3f(2.0, 0.0, 0.0);


			glColor3f(0.0, 1.0, 0.0);
			glVertex3f(0.0, 0.0, 0.0);
			glVertex3f(0.0, 2.0, 0.0);

			glColor3f(0.0, 0.0, 1.0);
			glVertex3f(0.0, 0.0, 0.0);
			glVertex3f(0.0, 0.0, 2.0);
			glColor3f(1.0, 1.0, 1.0);
		glEnd();
		
		if(isEnabled)
			glEnable(GL_LIGHTING);
	glPopMatrix();
}

void motionBlur(){
	if(displayMotionBlur){
		glAccum(GL_MULT, 0.2);
		glAccum(GL_ACCUM, 1-0.2);
		glAccum(GL_RETURN, 1.0);
		glFlush();
	}
}

void fog(){
	if(displayFog){
		glEnable(GL_FOG);
		{
			GLfloat fogColor[4] = {0.894, 0.678, 0.525, 0.5};
			glFogi (GL_FOG_MODE, GL_LINEAR);
			glFogfv (GL_FOG_COLOR, fogColor);
			//glFogf (GL_FOG_DENSITY, 0.35);
			glHint (GL_FOG_HINT, GL_DONT_CARE);
			glFogf (GL_FOG_START, 1.0);
			glFogf (GL_FOG_END, 5.0);
		}
		glClearColor(0.894, 0.678, 0.525, 0.5);  /* fog color */
	}
	else
		glDisable(GL_FOG);
}

void terrain(){

	int height[88][88] ={

			//1
			{0,2,1,2,3,4,3,4,3,3,3,3,4,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,8,7,6,5,4,3,2,1,1,1,0,1,
			2,2,2,1,2,3,4,3,2,2,3,4,4,5,5,5,5,4,4,3,0,1,1,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,5,6,7,7,8,7,6,4,5,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//2
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//3
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//4
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//5
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//6
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//7
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//8
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//9
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//10
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3},
			//11
			{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //
			{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
			1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
			{1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,
			1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1,1,3,2,3,3,4,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,
			1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1,1,2,1,2,2,2,2,1},
			{1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,
			1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2,1,2,2,3,3,3,3,2},
			{1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,
			1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3,1,2,2,3,4,4,3,3}
	};

	int MAP_SIZE = 88;

	glEnable(GL_TEXTURE_2D);
	glPushMatrix();
	GLfloat mat_specular[] = {4.0, 2.0, 2.0, 1.0};
	GLfloat mat_shininess[] = {50.0f};
	glShadeModel (GL_SMOOTH);
	glMaterialfv(GL_FRONT, GL_SPECULAR, mat_specular);
	glMaterialfv(GL_FRONT, GL_SHININESS, mat_shininess);
	GLfloat mat_diffuse[] = {0.843, 0.514, 0.278, 1.0f};
	glMaterialfv(GL_FRONT, GL_DIFFUSE, mat_diffuse);
	glColor3f(0.2f, 0.2f, 1.0f);
	glTranslatef(-44.0f,-2.0f,-44.0f);
    for (int x = 1; x < MAP_SIZE-1; x++) { 
      for (int z = 1; z < MAP_SIZE-1; z++) {
		glBegin(GL_QUADS);
			glBindTexture(GL_TEXTURE_2D, texture1);
			glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
			glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
			glVertex3f(x,height[x][z],z);
			glVertex3f(x+1,height[x+1][z],z);
			glVertex3f(x+1,height[x+1][z+1],z + 1);
			glVertex3f(x,height[x][z+1],z+1);
			glClearColor(1.0f, 1.0f, 1.0f, 1.0f);
        glEnd();
      }
    }
    glPopMatrix();
}

void renderScene(void) {

	glClearColor(0.0f, 0.0f, 0.0f, 0.0f);
	glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
	
	glLoadIdentity();
	gluLookAt(15.0, 15.0,	15.0,
			  0.0,	0.0,	0.0,
		      0.0f,	1.0f,	0.0f);	
	
	drawAxes();

	glLightfv(GL_LIGHT0, GL_AMBIENT, lightAmb);
	glLightfv(GL_LIGHT0, GL_DIFFUSE, lightDiff);
	
	glTranslatef(x,y,z);
	glRotatef(rotX, 1.0, 0.0, 0.0);
	
	glBindTexture(GL_TEXTURE_2D, texture1);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
	
	//Build the Height Map
	terrain();

	//Display Fog
	fog();

	//motion blur
	motionBlur();

	//1 way
	glCallList(displayList);
	
	glTranslatef(0, 4, 0);
	
	glutSwapBuffers();
}

void init(int argc, char **argv)
{
	glutInit(&argc, argv);
	glutInitDisplayMode(GLUT_DEPTH | GLUT_DOUBLE | GLUT_RGBA);
	glutInitWindowPosition(100, 100);
	glutInitWindowSize(800, 600);
	glutCreateWindow("Project");

	glEnable(GL_TEXTURE_2D);
	glLightfv(GL_LIGHT0, GL_POSITION, lightPos);
	glEnable(GL_DEPTH_TEST);
	glEnable(GL_LIGHTING);
	glEnable(GL_LIGHT0);
	glEnable(GL_COLOR_MATERIAL);

	//Load model
	mymodel1 = glmReadOBJ("3dFalconFINAL.obj");

	//There are for preparing our model
	glmUnitize(mymodel1);
	glmFacetNormals(mymodel1);
	glmVertexNormals(mymodel1, 90);

	displayList=glGenLists(1);
	glNewList(displayList,GL_COMPILE);
	glmDraw(mymodel1, GLM_SMOOTH | GLM_MATERIAL | GLM_TEXTURE);
	glEndList();

	//Loads corresponding texture
	//Image* image = loadBMP("models/rock.bmp");
	//texture1 = loadTexture(image);
	//delete image;

}

int main(int argc, char **argv) {
	init(argc, argv);
	
	
	// por registo de funcoes aqui
	glutDisplayFunc(renderScene);
	glutKeyboardFunc(keyboard);
	//glutIdleFunc(renderScene);
	glutReshapeFunc(changeSize);
	
	glutMainLoop();
	
	return 0;
}

